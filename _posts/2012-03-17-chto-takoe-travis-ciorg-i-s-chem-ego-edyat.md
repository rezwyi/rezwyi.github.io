---
layout: post
title: Что такое travis-ci.org и с чем его едят?
---

Наверняка все слышали шумиху вокруг проекта [travis-ci.org](http://travis-ci.org/). Я не являюсь исключением и учитывая, что один из его разработчиков, [Джош Калдеримис (Josh Kalderimis)](http://twitter.com/joshkalderimis), выступивший на прошедшей конференции [toster.ru](http://toster.ru/conferences/10-02-2012-ruby/results), разжег мой интерес еще больше, то я решил окончательно разобраться, что такое travis-ci и с чем его едят. После прочтения вы узнаете как данный сервис может помочь ruby-разработчикам, а также как ему могут помочь они. Располагайтесь поудобнее, начнем...

## Непрерывная интеграция

Как оказалось, термин "continuous integration" достаточно старый. Он был введен [Мартином Фаулером (Martin Fowler)](http://martinfowler.com) в 2000-ом году и изложен в статье ["Continuous Integration"](http://martinfowler.com/articles/continuousintegration.html) и по-русски звучит как "непрерывная интеграция". Это часть процесса разработки, в которой разрабатываемый проект собирается/тестируется в различных средах выполнения автоматически и непрерывно. Задумывалась данная методика для наиболее быстрого выявления ошибок/противоречий интеграции проекта, а соотвественно снижения расходов на последующие простои.

Принцип достаточно прост: на отдельной машине работает некая служба, в обязанности которой входит получение исходного кода проекта, его сборка, тестирование, логирование, а также возможность предоставить для анализа данные выполнения перечисленных операций.

Конечно же, бесплатный сыр бывает только в мышеловке и за удобство необходимо платить: выделить отдельный сервер и поддерживать его в рабочем состоянии, обеспечить наличие необходимых программных комплексов, настроить среды выполнения, делать резервные копии данных и т.д. Все это требует немало времени и ресурсов. И вполне логичным кажется возможность делегировать эту ответсвенность на сторонние сервисы. Вот как раз таким и является travis-ci - "хостинг непрерывной интеграции для open source сообщества". Пришло время посмотреть на него поближе.

## Техническая сторона

Travis-ci поддерживает множество языков программирования среди которых есть и Ruby (что неудивительно, т.к. изначально он разрабатывался для ruby-проектов). Начать пользоваться сервисом очень просто. Нужно всего лишь предпринять несколько шагов, которые подробно описаны в собственном [гайде](http://about.travis-ci.org/docs/user/getting-started/) проекта. Я лишь опишу процесс в целом.

### Подключаемся

Travis-ci работает с сервисом [github.com](http://github.com), поэтому первым делом необходимо выложить туда исходный код своего проекта. За исключением мелких технических настроек (вроде установки хуков в репозитории), весь процесс сводится к описанию различных опций в файле .travis.yml. В нем нужно описать на каком языке работает проект, какие версии языка необходимо использовать (можно сразу все), среды окружения ([здесь](http://about.travis-ci.org/docs/user/languages/ruby/) приведен пример такого файла для Ruby). Данный файл необходимо разместить в корне github-репозитория.

Если настройка прошла успешно, то travis-ci начинает непрерывно тестировать проект, отображая при этом текущий статус: красный цвет (возникли проблемы при тестировании), желтый (есть предупреждения) и зеленый (все тесты пройдены успешно). Помимо статуса можно увидеть: сообщение об ошибке или предупреждение, если что-то пошло не так; последний коммит и его автора; историю сборок и т.д. В целом интерфейс достаточно информативен и понятен. Помимо этого, travis-ci будет оповещать о проблемах по электронной почте.

### Особенности работы сервиса

  0. В момент, когда файл `.travis.yml` попадает в корень github-репозитория, работа начинается только тогда, когда освободится любой один обработчик (worker) для языка проекта.
  0. Тестированию подвергаются все активные бранчи проекта, в которых присутствует файл `.travis.yml`.
  0. Состояние программной среды между сборками не сохраняется. Это значит, что если в процессе тестирования была изменена база данных, созданы какие-либо файлы и т.д., то в последующих сборках эти результаты будут недоступны. Каждая новая сборка начинается с чистого листа.
  0. Чтобы не наделать ошибок в файле `.travis.yml` существует утилита [travis-lint](http://github.com/travis-ci/travis-lint). Она может проверить:
     + Нет ли несоответствий формату YAML
     + Ключ `language` указан
     + Поддерживает ли travis-ci указанные среды выполнения
     + В файле не используются устаревшие функции
  0. Для максимальной эффективности применяется т.н. матрица сборок. Это означает, что при указании нескольких сред выполнения, переменных окружения и т.д. в одном файле, будет автоматически выстраиваться цепочка всех возможных комбинаций, которые будут использоваться для сборок. Для рассмотренного ниже примера будут выполнены четыре сборки:

{% highlight yaml %}
# travis.yml
rvm:
  - 1.9.3
  - rbx-18mode
env:
  - FOO=foo BAR=bar
  - FOO=bar BAR=foo
{% endhighlight %}

## Интересные факты

  0. "Travis" в названии сервиса означает имя мультяшного персонажа - трактора Трэвиса, из детского телешоу ["Bob The Builder"](http://en.wikipedia.org/wiki/Bob_the_Builder).
  0. Чтобы промотивировать общественность помочь проекту в финансовом плане, авторы создали сайт [love.travis-ci.org](https://love.travis-ci.org/), где можно пожертвовать некоторую сумму на поддержку и в зависимости от размера суммы, авторы в ответ презентуют различные сувениры: стикеры, кружки и прочее. Интересно также, что на этом же сайте описаны некоторые планы на будущее, в том числе и по монетизации.

## Заключение

Travis-ci волей - не волей, вызывает к себе интерес. Учитывая еще тот факт, что в данный момент на нем хостятся довольно крупные и известные проекты, спрос на такие услуги есть. Сервис только набирает обороты и хочется пожелать ему обрести большое сообщество пользователей.

## Ссылки

  0. [Сайт сервиса](http://travis-ci.org/)
  0. [Документация по сервису](http://about.travis-ci.org/)
  0. [Профиль проекта на github.com](https://github.com/travis-ci/)
  0. [Твиттер Джоша Калдеримиса](http://twitter.com/joshkalderimis)
  0. [Твиттер Свена Фукса](http://twitter.com/svenfuchs)
  0. [Статья Мартина Фаулера "Continuous Integration"](http://martinfowler.com/articles/continuousintegration.html)

## (UPDATE #1)

Благодаря данной статье, я получил инвайт на Хабрахабр (вот [она](http://habrahabr.ru/post/140344/)). Приношу свои благодарности человеку, который мне его дал (к сожалению, не знаю кто это).

Еще раз всем спасибо и удачи :)